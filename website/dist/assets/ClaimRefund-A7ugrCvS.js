import{r,j as e,t as P,w as J}from"./index-P9AEKrjw.js";import{S as Q}from"./search-DO5pF8ph.js";import"./createLucideIcon-CHvZU8O2.js";const Y=({customerData:w,selectedItems:f,onBack:B})=>{function v(){const t=new Date().toISOString().slice(0,10).replace(/-/g,""),o=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`RMA-${t}-${o}`}const[k,C]=r.useState(""),[S,d]=r.useState(""),[A,_]=r.useState(""),[O,R]=r.useState(""),[b,j]=r.useState(""),[y,I]=r.useState(""),[u,L]=r.useState([]),[M,z]=r.useState("");r.useEffect(()=>{L(f||[])},[f]),r.useEffect(()=>{var t,o,m,i,x;if(w&&w.length>0){const n=w[0];C(n.invoice_number),d(n.customer_id),_((o=(t=n.customer)==null?void 0:t.user)==null?void 0:o.name),R((i=(m=n.customer)==null?void 0:m.user)==null?void 0:i.email),j((x=n.order)==null?void 0:x.id)}},[w]),r.useEffect(()=>{if(k&&S&&b){const t=v();I(t)}},[k,S,b]);const G=async()=>{try{const t=new Date().toISOString().slice(0,10),m=await fetch("https://admin.mobileswholesale.co.uk/api/rmas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rma_number:y,customer_id:S,order_id:b,request_date:t,status:"Requested",reason:M||"The user has not provided any comments",resolved_by:13,resolved_date:t,is_active:0})});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const i=await m.json(),x=i==null?void 0:i.id;if(console.log("RMAS created successfully:",i),x)for(const n of u){const F={rma_id:x,inventory_id:n.inventory_id,quantity:n.quantity,reason:n.reason||"No reason provided",is_active:0},$=await fetch("https://admin.mobileswholesale.co.uk/api/rma-items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(!$.ok)console.error(`Failed to create rma item for inventory_id: ${n.inventory_id}`);else{const q=await $.json();console.log("RMA item created successfully:",q)}}P.success("RMAS and associated items created successfully!"),window.location.href="/claim_refund"}catch(t){console.error("Error creating RMAS or RMA items:",t),P.error("An error occurred while creating RMAS.")}};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsx("div",{className:"w-full max-w-screen-4xl mx-auto space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"bg-custom-pri px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Generate Credit Note"}),e.jsx("p",{className:"text-blue-100",children:"Fill in the details below to generate a credit note."})]}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"bg-gray-100 p-6 rounded-xl border border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-6 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Customer Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"RMAS Number"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800 mt-1",children:y})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800 mt-1",children:k})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer Name"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800 mt-1",children:A})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer Email"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800 truncate mt-1",children:O})]})]})]}),e.jsxs("div",{className:"bg-gray-100 p-6 rounded-xl border border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-6 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),"General Comments"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-blue-800",children:"Reason for Credit Note"}),e.jsx("textarea",{className:"w-full px-4 py-3 text-gray-700 border-2 border-purple-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-100 focus:border-transparent bg-white shadow-sm",id:"reason",name:"reason",placeholder:"Please provide the general reason for this credit note...",rows:"4",value:M,onChange:t=>z(t.target.value)})]})]}),e.jsxs("div",{className:"bg-gray-100 p-6 rounded-xl border border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-blue-800 mb-6 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),"Products for Return"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map((t,o)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-all",children:[e.jsx("div",{className:"bg-custom-pri px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"bg-white text-blue-800 text-xs font-bold px-2.5 py-1 rounded-full",children:["#",o+1]}),e.jsxs("span",{className:"text-sm font-medium text-white",children:["$",t.total_price]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2 truncate",children:t.product_name}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:t.quantity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Unit Price"}),e.jsxs("p",{className:"font-medium",children:["$",(t.total_price/t.quantity).toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:`reason-${o}`,className:"block text-xs font-medium text-gray-700",children:"Return Reason"}),e.jsx("textarea",{className:"w-full px-3 py-2 text-sm border-2 border-pink-100 rounded-lg focus:outline-none focus:ring-1 focus:ring-pink-500 focus:border-pink-300",id:`reason-${o}`,name:`reason-${o}`,value:t.reason||"",onChange:m=>{const i=[...u];i[o].reason=m.target.value,L(i)},placeholder:"Specific reason for this product...",rows:"2"})]})]})]},o))})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsxs("button",{className:"px-6 py-2.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors font-medium flex items-center",onClick:B,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back"]}),e.jsxs("button",{className:"px-6 py-2.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-700 focus:ring-offset-2 font-medium bg-custom-pri hover:bg-custom-pri-dark transition-all shadow-md flex items-center",onClick:G,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Create RMAS"]})]})]})]})})})},K=w=>{var x,n,F,$,q,W,U;document.title="Credit Note";const[f,B]=r.useState(""),[v,k]=r.useState(""),[C,S]=r.useState(""),[d,A]=r.useState(null),[_,O]=r.useState([]),[R,b]=r.useState(!1),[j,y]=r.useState([]),[I,u]=r.useState({}),[L,M]=r.useState(!1),[z,G]=r.useState([]),t=async()=>{b(!0);try{const s=[];f&&s.push(`name=${encodeURIComponent(f)}`),v&&s.push(`email=${encodeURIComponent(v)}`),C&&s.push(`invoice_number=${encodeURIComponent(C)}`);const l=s.length>0?`?${s.join("&")}`:"",c=await(await fetch(`https://admin.mobileswholesale.co.uk/api/invoices${l}`)).json();if(c.data.data.length>0){A(c.data.data),P.success("Customer data found successfully!");const g=c.data.data.map(h=>h.order_id).map(h=>fetch(`https://admin.mobileswholesale.co.uk/api/order-items?order_id=${h}`).then(D=>D.json())),p=(await Promise.all(g)).flatMap(h=>h.data.data);O(p),y([]),u({})}else A(null),O([]),y([]),u({}),P.error("No customer available with the provided information")}catch(s){console.error("Error fetching data:",s),P.error("Failed to fetch data. Please try again.")}finally{b(!1)}},o=()=>{const s=j.map(l=>{var c,N,g;const a=_.find(E=>{var p;return((p=E.inventory)==null?void 0:p.id)===l});return{inventory_id:l,quantity:a==null?void 0:a.quantity,reason:I[l]||"",product_name:(g=(N=(c=a==null?void 0:a.inventory)==null?void 0:c.variant)==null?void 0:N.product)==null?void 0:g.model_name,total_price:a==null?void 0:a.total_price}});G(s),M(!0)},m=s=>{y(l=>{if(l.includes(s)){const a={...I};return delete a[s],u(a),l.filter(c=>c!==s)}else return u(a=>({...a,[s]:""})),[...l,s]})},i=(s,l)=>{u(a=>({...a,[s]:l}))};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:L?e.jsx(Y,{customerData:d,selectedItems:z,onBack:()=>M(!1)}):e.jsxs("div",{className:"w-full max-w-screen-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl mt-10 shadow-md overflow-hidden border border-gray-200 w-full max-w-screen-4xl mx-auto",children:[e.jsxs("div",{className:"bg-custom-pri px-6 py-4",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Find Your Order"}),e.jsx("p",{className:"text-blue-100",children:"Verify your purchase to begin the refund process"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"flex-grow min-w-48",children:[e.jsx("label",{htmlFor:"name-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Name"}),e.jsx("input",{id:"name-input",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",type:"text",value:f,onChange:s=>B(s.target.value),placeholder:"Enter customer name"})]}),e.jsxs("div",{className:"flex-grow min-w-48",children:[e.jsx("label",{htmlFor:"email-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Email"}),e.jsx("input",{id:"email-input",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",type:"email",value:v,onChange:s=>k(s.target.value),placeholder:"Enter customer email"})]}),e.jsxs("div",{className:"flex-grow min-w-48",children:[e.jsx("label",{htmlFor:"invoice-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{id:"invoice-input",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",type:"text",value:C,onChange:s=>S(s.target.value),placeholder:"Enter invoice number"})]}),e.jsx("button",{className:`px-6 py-2 h-10 rounded-lg text-white font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-2
                    ${R?"bg-blue-400 cursor-not-allowed":"bg-custom-pri-light hover:bg-custom-pri shadow-md"}`,onClick:t,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18}),"Search"]})})]})})]}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-md mt-20 overflow-hidden border border-gray-200 w-full max-w-screen-4xl mx-auto",children:e.jsxs("div",{className:"w-full max-w-8xl bg-white rounded-xl shadow-md overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"bg-custom-pri px-6 py-4",children:[e.jsxs("h2",{className:"text-lg font-bold text-white",children:["INVOICE #",(x=d[0])==null?void 0:x.invoice_number]}),e.jsxs("p",{className:"text-pink-100",children:[(n=d[0])==null?void 0:n.customer.user.name,"'s Order"]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Customer Email"}),e.jsx("p",{className:"text-gray-800",children:(F=d[0])==null?void 0:F.customer.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Payment Method"}),e.jsx("p",{className:"text-gray-800",children:($=d[0])==null?void 0:$.order.payment_method})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Order Total"}),e.jsxs("p",{className:"text-gray-800",children:["$",(q=d[0])==null?void 0:q.order.total_amount]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Discount"}),e.jsxs("p",{className:"text-gray-800",children:["$",(W=d[0])==null?void 0:W.order.discount_amount]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Grand Total"}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["$",(U=d[0])==null?void 0:U.order.grand_total]})]})]})]})})]})}),_.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white mt-20 rounded-xl shadow-md overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"bg-custom-pri px-6 py-4",children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:"Order Items"}),e.jsx("p",{className:"text-blue-100",children:"Select items for credit note"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map((s,l)=>{var a,c,N,g,E,p,h,D,V;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200 flex items-center justify-center",children:[e.jsx("img",{src:`http://localhost:8000/storage/${(N=(c=(a=s.inventory)==null?void 0:a.variant)==null?void 0:c.product)==null?void 0:N.feature_imageUrl}`,className:"h-40 w-auto object-contain",alt:"Product"}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-pink-600 focus:ring-pink-500 border-gray-300 rounded",checked:j.includes((g=s.inventory)==null?void 0:g.id),onChange:()=>{var T;return m((T=s.inventory)==null?void 0:T.id)}})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:(h=(p=(E=s.inventory)==null?void 0:E.variant)==null?void 0:p.product)==null?void 0:h.model_name}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["$",s.total_price]})]})]}),j.includes((D=s.inventory)==null?void 0:D.id)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm text-gray-500 mb-1",children:"Reason for return"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-700 text-sm",value:I[(V=s.inventory)==null?void 0:V.id]||"",onChange:T=>{var H;return i((H=s.inventory)==null?void 0:H.id,T.target.value)},placeholder:"Enter reason"})]})]})]},`item-${l}`)})})})]}),j.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:`px-6 py-2.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-700 focus:ring-offset-2 font-medium\r
          bg-custom-pri-light hover:bg-custom-pri transition-all shadow-md`,onClick:o,children:"Generate Credit Note"})})]})]})]})})},se=J(null)(K);export{se as default};
